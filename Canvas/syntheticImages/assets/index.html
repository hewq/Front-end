<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Html5 Canvas 实现图片合成</title>
    <meta name="viewport" content="width=device-width, maximum-scale=1.0, initial-scale=1.0">
    <script src="js/jquery.min.js"></script>
    <script src="js/canvas2image.js"></script>
</head>

<body>
<div id="imgBox" align="center"></div>
<script>
    function draw(fn){
        var data1= new Array();
        data1.push("images/end_wolf.jpg");
        data1.push("images/end_witch.jpg");
        var c=document.createElement('canvas'),
            ctx=c.getContext('2d'),
            len=data1.length;
        c.width=400;
        c.height=400;
        function drawing(n){
            if(n<len){
                var img=new Image;
                img.src=data1[n];
                if(n==0){
                    img.onload=function(){
                        ctx.drawImage(img,0,0,400,400);
                        drawing(n+1);//递归
                    }
                }else {
                    img.onload=function(){
                        ctx.drawImage(img,img.width/2,0,img.width/2,img.height,200,0,200,400);
                        drawing(n+1);//递归
                    }
                }
            }else{
                //保存生成作品图片
                convertCanvasToImage(c);
            }
        }
        drawing(0);
    }
    function convertCanvasToImage(canvas) {
        var hc_image = new Image();
        hc_image.src = canvas.toDataURL("image/png");
        $('#imgBox').html(hc_image);
    }
    draw();
</script>
</body>
</html>